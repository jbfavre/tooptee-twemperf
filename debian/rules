#!/usr/bin/make -f

DEB_BUILD_HARDENING=1
export DEB_BUILD_HARDENING

DEB_HOST_GNU_TYPE   ?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
DEB_BUILD_GNU_TYPE  ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)

PACKAGE=twemcache
PKGBASE=debian/$(PACKAGE)/usr/share/$(PACKAGE)
SCRIPTS=$(PKGBASE)/scripts

CFLAGS=-Wall -g 

ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
	CFLAGS +=-O0
else
	CFLAGS +=-O2
endif
ifeq (,$(findstring nostrip,$(DEB_BUILD_OPTIONS)))
	INSTALL_PROGRAM += -s
endif

%:
	dh $@ --with autoreconf

override_dh_clean:
	rm -f Makefile Makefile.in aclocal.m4 config.h config.h.in config.log config.status configure stamp-h1
	rm -fr ./autom4te.cache ./config
	rm -fr ./src/.deps/ ./src/Makefile ./src/Makefile.in
	rm -fr ./src/gen/.deps/ ./src/gen/Makefile ./src/gen/Makefile.in
	rm -fr ./src/stats/.deps/ ./src/stats/Makefile ./src/stats/Makefile.in
	rm -rf .pc
	dh_clean
